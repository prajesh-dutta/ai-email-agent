Act as a Senior Python Developer. I need you to build a complete, single-file Streamlit application named `app.py` for a "Prompt-Driven Email Productivity Agent". This is for a strict university assignment.

**Goal:** Create a deploy-ready app that simulates an email client, processes emails using the Google Gemini API, and allows users to control the AI's behavior by editing "System Prompts" in the UI.

### 1. Technical Stack
* **Frontend/Backend:** Python + Streamlit (must use `st.session_state` for all data persistence).
* **AI Model:** `google.generativeai` (Gemini).
* **Deployment:** The code must run cleanly on Streamlit Cloud without external database dependencies.

### 2. Functional Requirements (Must Implement)

**A. Data Layer (The Mock Inbox)**
* On startup, initialize a `MockInbox` in `st.session_state` with 10 varied emails.
* Include: Meeting requests, Newsletters, Spam, Task requests, and Project updates.
* Data structure: `{"id": 1, "sender": "...", "subject": "...", "body": "...", "date": "...", "read": False, "category": None, "action_items": None}`.

**B. Phase 1: The "Agent Brain" (Prompt Configuration)**
* Create a Sidebar named "Agent Brain".
* Allow the user to View and Edit 3 core prompts. Use these exact defaults:
    1.  **Categorization Prompt:** "Categorize emails into: Important, Newsletter, Spam, To-Do. To-Do emails must include a direct request."
    2.  **Action Extraction Prompt:** "Extract tasks from the email. Respond in strictly valid JSON: [{'task': '...', 'deadline': '...'}]."
    3.  **Auto-Reply Prompt:** "If an email is a meeting request, draft a polite reply asking for an agenda. Otherwise, acknowledge receipt."

**C. Phase 2: Inbox & Processing**
* **Tab 1: Inbox:** Display the list of emails (Sender, Subject, Category).
* **"Process Inbox" Button:** When clicked, iterate through all emails. Send the email body + the *User's Categorization Prompt* to Gemini to tag the email. Update the UI.

**D. Phase 3: Email Agent (Chat & Actions)**
* **Tab 2: Email Agent:**
    * Allow the user to select a specific email from a dropdown.
    * Display the full email content.
    * **Chat Interface:** Allow the user to ask questions like "Summarize this" or "What are the deadlines?". The AI must answer using the selected email context.
    * **Action Extraction:** Add a button "Extract Action Items". When clicked, use the *User's Action Extraction Prompt* to generate and display the JSON list.
    * **Draft Reply:** Add a button "Generate Draft Reply". When clicked, use the *User's Auto-Reply Prompt* to generate an email response.

**E. Phase 4: Drafts (Safety)**
* **Tab 3: Drafts:** Display all generated drafts.
* **Safety Rule:** Never have a "Send" button. Only "Save Draft" or "Delete".

### 3. Implementation Details
* **API Key:** Use `st.secrets["GOOGLE_API_KEY"]` but also provide a text input in the sidebar to paste the key manually for testing.
* **Error Handling:** If the API fails, show a friendly `st.error` message.
* **Code Quality:** Add comments explaining which part of the code corresponds to "Phase 1", "Phase 2", etc.

### Output
Provide two blocks of code:
1.  `requirements.txt`
2.  The complete `app.py`